# Ergo68 ビルドガイド

![completed_assembly_Front](imgs/Completed_assembly_Front.jpg)
![completed_assembly_Back](imgs/Completed_assembly_Back.jpg)

Ergo68のお買い上げありがとうございます。

**実際の組み立てを始める前に、このビルドガイドを最後までお読みください。**

組み立ては本手順に沿って行ってください。  
本手順に疑問等がある場合は遊舎工房の[サポートページ](https://yushakobo.zendesk.com/hc/ja)を参照の上、お気軽にお問い合わせください。

## 注意事項

本キットの組み立てにはニッパーなどの刃物やハンダごてなどの火傷の危険性がある道具を使用しますので、十分に注意して作業を行ってください。  
キットの部品には細かい部品も含まれますので、保管する際はお子様などの手に届かない場所に保管してください。  
作業中に出るゴミ、切ったダイオードの足やピンヘッダの足などが刺さったりしますので、適宜清掃をしながら作業されることをお勧めします。
**PCとUSBケーブルで接続中に左右間をつなぐTRSケーブルを抜いてしまうと故障の原因になります。**  
**絶対にPCと接続中に左右間をつなぐケーブルを抜かないでください。**  

## １．キットに同梱されている部品をチェックする

まずはキットに同梱されている部品が足りているかチェックしてください。  
万が一部品に不足がある場合は、大変お手数ですが遊舎工房の[お問い合わせフォーム](https://yushakobo.zendesk.com/hc/ja/requests/new)のカテゴリ **「購入した商品の不足・初期不良等」** を選択してお問い合わせください。

|名称|数量|画像|
|---|---|---|
|基板|2|![PCB](imgs/PCB.JPG)|
|スイッチプレート|2|![SW_Plate](imgs/SW_Plate.JPG)|
|ボトムプレート|2|![Bottom_Plate](imgs/Bottom_Plate.JPG)|
|カバープレート|2|![Cover_Plate](imgs/Cover_Plate.JPG)|
|ProMicro|2|![ProMicro](imgs/ProMicro.JPG)|
|コンスルー（12ピン）|4|![Conthrough](imgs/Conthrough.JPG)|
|リセットスイッチ|2|![ResetSwitch](imgs/ResetSwitch.JPG)|
|TRRSジャック|2|![TRRS](imgs/TRRS.JPG)|
|ネジ（4mm）|28|![Screw](imgs/Screw.JPG)|
|スペーサー（7mm）|14|![Spacer](imgs/Spacer7mm.JPG)|
|スペーサー・オスメス（4mm）|8|![Spacer](imgs/Spacer4mm.JPG)|
|ゴム足(小)|4|![Cushion](imgs/Cushion.JPG)|
|ゴム足(大)|4|![Cushion](imgs/Cushion.JPG)|

### １－１．オプション部品（電池部品キット）

|名称|数量|画像|
|---|---|---|
|コイン電池ホルダー|4|![Battery](imgs/Battery.JPG)|
|コンスルー|1|![Conthrough2mm](imgs/Conthrough2mm.JPG)|
|ショットキーバリアダイオード|4|![Diode](imgs/Diode.JPG)|
|チップコンデンサ|2|![Condenser](imgs/Condenser.JPG)|
|スライドスイッチ|2|![SlideSW](imgs/SlideSW.JPG)|

### １－２．オプション部品（単4電池部品キット）

|名称|数量|画像|
|---|---|---|
|単4電池ホルダー|4|![BatteryAAA](imgs/BatteryAAA.JPG)|
|コンスルー|1|![Conthrough2mm](imgs/Conthrough2mm.JPG)|
|ショットキーバリアダイオード|4|![Diode](imgs/Diode.JPG)|
|チップコンデンサ|2|![Condenser](imgs/Condenser.JPG)|
|スライドスイッチ|2|![SlideSW](imgs/SlideSW.JPG)|
|カバープレート（単4電池用）|2|![Cover_Plate_AAA](imgs/Cover_Plate_AAA.JPG)|
|スペーサー・オスメス（8mm）|8|![Spacer](imgs/XXXX.jpg)|
|ゴム足(大)|4|![Cushion](imgs/Cushion.JPG)|

### １－３．オプション部品（ミドルプレート）

|名称|数量|画像|
|---|---|---|
|ミドルプレート(2mm)|2|![Middle2mm](imgs/Middle2mm.png)|
|ミドルプレート(5mm)|4|![Middle5mm](imgs/Middle5mm.png)|

## ２．別途準備するパーツをチェックする

キットには含まれていないパーツは別途用意する必要があります。  
予め購入し、組立前に不足がないかチェックしてください。

|名称|数量|備考|
|---|---|---|
|キースイッチ|68|ご購入は[こちら](https://shop.yushakobo.jp/collections/all-switches/cherry-mx-%E4%BA%92%E6%8F%9B-%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81)<br>CherryMX互換スイッチのみ対応|
|キーキャップ|68|ご購入は[こちら](https://shop.yushakobo.jp/collections/keycaps/cherry-mx-%E4%BA%92%E6%8F%9B-%E3%82%AD%E3%83%BC%E3%82%AD%E3%83%A3%E3%83%83%E3%83%97)<br>キーレイアウトとキーキャップセットをよくチェックして購入してください|
|TRSケーブルorTRRSケーブル|1|ご購入は[こちら](https://shop.yushakobo.jp/products/trrs_cable)<br>LPME-IOの場合はTRRSケーブルのみ<br>TRSは3極、TRRSは4極の端子を持ちます|
|USBケーブル|1|ご購入は[こちら](https://shop.yushakobo.jp/products/usb-cable-micro-b-0-8m)<br>マイコンが対応するコネクタの種類に合わせてご用意ください<br>標準で付属するProMicroはMicroBケーブルが必要です|

## 必要な道具

|名称|備考|
|---|---|
|ハンダごて|できるだけ温度調節機能付きのもの|
|ハンダ線|0.6mm~0.8mm径程度のもの|
|ドライバー|M2サイズのネジを締める用のもの（#0）|
|ニッパー|なるべく先端が細いもの|

**こちらに[工具セット](https://shop.yushakobo.jp/products/a9900to)の用意もありますので、よろしければ部品と一緒にどうぞ。**

## 組み立ての手順

1. ProMicroとコンスルーのハンダ付け
1. リセットスイッチとTRRSジャックのハンダ付け
1. ファームウェアの書き込みと動作確認
1. 基板の左右の捨板を折り取る
1. キースイッチのスイッチプレートへの取り付け
1. スペーサーのネジ止め
1. ボトムプレートのネジ止め
1. カバープレートのネジ止め
1. キーキャップの取り付け
1. ゴム足の貼り付け
1. キーマップを変更する
1. (オプション)電池部品キットのハンダ付け

## 1. ProMicroとコンスルーのハンダ付け

**Check:ProMicroの裏表に十分に注意してください。**  
**逆に取り付けてしまった場合、コンスルーを取り外すのはとても大変です。**  

**Check:無線対応をしたい場合、ProMicroの代わりにBLE Micro Proを使用しますが、ハンダ付けは不要です。**  
**後述の「EX1．無線対応」を代わりに参照してください。**  

### 1-1．コンスルーの差し込み

ピンソケットを基板の **裏側** から差し込みます。  

![ProMicro-1](imgs/ProMicro-1.JPG)  

この際に、下の写真のようにコンスルーの側面から金属が見える側を揃えてください。  
**Check:ProMicroを使う場合は基板の一番上のピンは差し込まず開けておきます。**  

![ProMicro-2](imgs/ProMicro-2.JPG)  

また、コンスルーには上下があります。  
金属が見える窓は上下のどちらかに寄っていますので、上側に寄っている側が来るように差し込んでください。

![ProMicro-3](imgs/ProMicro-3.JPG)  

### 1-2．ProMicroのハンダ付け

ProMicroの部品が見える側を上面にし、コンスルーに差し込みます。  

![ProMicro-4](imgs/ProMicro-4.JPG)  

このとき、ProMicroの向きに十分に注意します。  
基板の**表側**からProMicroの**チップ部品が見えるように**なっているはずです。  
後でProMicroのハンダを外すのは大変な労力を伴いますので、ここで**必ず上の写真と相違が無いかチェック**しておきます。  

ハンダ付けの際は2～3mm程度のハンダを送るだけで十分です。  
ハンダごてを当て、1～2秒待ってからハンダを送ります。  
また1～2秒待ってからハンダを離し、その後ハンダごてを離します。  
以下の画像のようになればOKです。

## 2. リセットスイッチとTRRSジャックのハンダ付け

**Point:リセットスイッチはハンダ付けせずに使うことも出来ます。**  
**使う機会も少ないので、頻繁にファームウェアを書き換える予定がなければハンダ付けを省略しても大丈夫です。**  
**なお、一度ファームウェアを書き込んでしまえば、キーマップの書き換えにはリセットスイッチは不要です。**  

基板裏側のProMicroの反対側の`Reset`と`TRRS`と書かれている部分にリセットスイッチとTRRSジャックを**裏面**に取り付け、**表側**からハンダ付けします。  

左側![ResetTRRS-Left](imgs/ResetTRRS-Left.JPG)  
右側![ResetTRRS-Right](imgs/ResetTRRS-Right.JPG)  

ハンダ付けした後、ニッパーで切り取ってもう一度ハンダごてで温めることで机に傷をつけずに使うことが出来ます。

![ResetTRRS](imgs/ResetTRRS.JPG)  

## 3. ファームウェアの書き込みと動作確認

Ergo68はファームウェアとしてqmk_firmwareを使用しています。  

Remapのカタログ機能を用いてファームウェアの書き込みを行います。  
**Check:※BLE Micro Proの書き込みは本ビルドガイドの末尾の`EX1-5．ファームウェアの書き込み`を参照してください。**  

https://remap-keys.app/catalog/qIgO7rOq7GMRsGf6QhlY/firmware

ファームウェアの書き込みが完了したらRemapのコンフィギュレータ画面を開きます。  

https://remap-keys.app/configure

FLASHをクリックします。

![Remap-1](imgs/Remap-1.png)  

通常のProMicroは「caterina」を、Elite-Cは「dfu」を選択してからFLASHをクリックします。  
※「dfu」を使用しての書き込みは別途Zadigというツールを用いた作業が必要になる場合があります。

![Remap-2](imgs/Remap-2.png)  

下図のように小ウインドウに「Arduino Micro」等が表示されることを確認します。  
表示されない場合、ケーブルや接続するポートを変更して試してみます。

![Remap-6](imgs/Remap-6.png)  

リセットスイッチを押すと一瞬USB機器が抜けたような音がするので先程の小ウインドウのArduino Microのポート番号が変化したことを確認し、素早く「接続」をクリック。  
（本ビルドガイドの図例の場合、COM17がCOM18に変化）  
ポート番号が変化しない場合、リセットを素早く2回実施する等も試してみてください。  

![Remap-7](imgs/Remap-7.png)  

ファームウェアの書き込みが完了したら下図のようにメッセージの最後に「successfully」が表示されます。
**Check:Elite-C等の通常のProMicroを使用しない場合は失敗する場合があります。**  
**Elite-Cなどを使用する場合はBootloaderをdfuに変更し、Remapの説明に従ってdfuのUSBモードを変更してください。**  

![Remap-8](imgs/Remap-8.png)  

まずはLEDが全て点灯するか確認してください。  

![Remap-9](imgs/Remap-9.JPG)  
![Remap-10](imgs/Remap-10.JPG)  
**Point:左右上部のLEDはインジケータです。**  
**左側がCapsLock、NumLock、ScreenLockです。**  
**右側がレイヤー状態です。**  
**ただPCを繋いだ状態でこれらのインジケータが消灯していても正常です。**  

Remapで正常に認識できたらテストモードを開き、ピンセットでスイッチソケットの金属部分に触れて導通をチェックします。  

![Remap-3](imgs/Remap-3.png)  
![Remap-4](imgs/Remap-4.JPG)  

全て正常だと下図のように全てのキーが青くなります。  
![Remap-5](imgs/Remap-5.png)  

## 4. 基板の左右の捨板を折り取る

基板の左右についている捨板を折り取ります。  

![PCB-1](imgs/PCB-1.JPG)  

**Check:折る際に基板全体に無理に力をかけるとスイッチソケットが剥がれる恐れがあります。**  
**折りづらい場合はカッターでなぞったりニッパーで切ってください。**  

![PCB-2](imgs/PCB-2.JPG)  

## 5．キースイッチのスイッチプレートへの取り付け

スイッチプレートにキースイッチを取り付けます。  
まずはスイッチプレートの四隅にスイッチを嵌めます。

![SW-1](imgs/SW-1.JPG)  

**Check:親結キーの部分のスイッチの向きだけ異なります。**  
**基板のスイッチソケットの向きと見比べ、正しい向きでスイッチプレートにはめ込みます。**  

![SW-2](imgs/SW-2.JPG)  

**Check:スイッチプレートにスイッチをちゃんとはめ込んでいることを確認します。**  

![SW-3](imgs/SW-3.JPG)  

**Check:ミドルプレートを取り付ける場合、基板とスイッチプレートの間にミドルプレート（2mm）をはさみます。**  
スイッチプレートを基板に合わせ、基板のスイッチソケットにスイッチの端子を嵌めます。  
**Check:スイッチソケットに差し込む前に、スイッチの向きが合っているか、ピンが折れ曲がっていないか再度確認します。**  

![SW-4](imgs/SW-4.JPG)  

**Check:スイッチは最後まで差し込んでください。**  

![SW-5](imgs/SW-5.JPG)  

全てのスイッチを取り付けます。
**Check:スイッチの向きに注意してください。**  
**Point:この時点でもう一度Remapでテストしておくと確実です。**  

![SW-6](imgs/SW-6.JPG)  

## 6. スペーサーのネジ止め

スイッチプレートにスペーサー(7mm)を取り付けます。  
スペーサーをスイッチプレート裏のネジ穴に配置し、指で抑えながらスイッチプレートの表側からネジ止めします。  
**Point:ミドルプレートを取り付ける場合、5mmのプレートを重ねておくとスペーサーが空回りしなくて締めやすくなります。**  
**Point:スペーサーを指で固定するのが難しければマスキングテープで軽く貼っておくとイライラせずにすみます。**  

![Screw-1](imgs/Screw-1.JPG)  
![Screw-2](imgs/Screw-2.JPG)  
![Screw-3](imgs/Screw-3.JPG)  
![Screw-4](imgs/Screw-4.JPG)  

## 7. ボトムプレートのネジ止め

**Point:無線対応を行う場合、ボトムプレートの前にEX1．無線対応を参照して、電池部品を取り付けてください。**  

ボトムプレートを被せ、下半分の3箇所をネジ止めします。  

![Screw-5](imgs/Screw-5.JPG)  

その後、上半分の4箇所にスペーサー・オスメス（4mm）を指でねじ込みます。  

![Screw-6](imgs/Screw-6.JPG)  

## 8. カバープレートのネジ止め

ボトムプレートの上半分のスペーサー・オスメス（4mm）の上部にカバープレートを乗せ、ネジ止めします。  
**Point:ProMicroにコンスルーを用いている場合、USBケーブルの抜き差しでコンスルーが抜けてしまってキーが効かなくなってしまう場合が結構あります。**  
**この問題を予防するために、ProMicroとカバープレートにクッションゴムを貼ることで抜けるのを抑止する手法があります。**  
**もし頻繁にUSBケーブルを抜き差しするなら、一度考えてみてください。**  

![Screw-7](imgs/Screw-7.JPG)  

## 9. キーキャップの取り付け

用意したキーキャップを取り付けます。

## 10. ゴム足の貼り付け

ボトムプレートとカバープレートの左右計8箇所にゴム足を貼り付けます。
背の高いゴム足はカバープレート側に貼り付けます。
貼り付け位置についてはボトムプレートとカバープレートの丸い印刷を参考にしてください。  

## 11. キーマップを変更する

あなたが使用しやすいようにキーマップを変更してください。  
キーマップの変更はRemapを使用すると便利です。

https://remap-keys.app/configure

Remapの使用方法は以下のサイトを参考にしてください。

https://salicylic-acid3.hatenablog.com/entry/remap-manual

## EX1. 無線対応

ProMicroの代わりにBLE Micro Proを使うことでBluetoothを用いた無線接続を行う事ができます。  
そのままProMicroを置き換えただけでもモバイルバッテリー等によるUSB給電を行えますが、BLE Micro Pro用電池基板の部品を用いることで、コイン電池（CR1632）を内蔵することが出来ます。  
BLE Micro Proの他に[LPME-IO](https://shop.yushakobo.jp/products/lpme-io2a)を用いた左右間だけ**4極**のTRRSケーブルを用いた部分無線を使用することもできます。  
ただし、BLE Micro Proを2つ用いた完全無線、BLE Micro ProとLPME-IOを組み合わせた部分無線は共に、PCと接続できるのは左側のキーボードだけです。  
右側のキーボードはキー押下を左側のキーボードに伝えるだけの役割です。  
また、BLE Micro Proを用いた無線接続の場合、USB給電時しかLEDは光らないので注意が必要です。  

### EX1-1. BLE Micro Proの取り付け

**Check:BLE Micro Proはコンスルーを用いる場合はハンダ付けは不要です。**  
**LPME-IOの場合も同様ですが、LPME-IOのマイコンボードへのジャンパが必要です。**  

13ピンコンスルー（別売）を使用する場合はそのまま使用してください。（推奨）  
キット同梱の12ピンコンスルーをBLE Micro Proで流用する場合は、以下の写真ように取り付けます。（LPME-IOでも同様）  
BLE Micro Proの（USBコネクタを上として）右上にバッテリー用のピンが有るので、右側だけ1ピン分オフセットしてコンスルーを取り付けます。  
コンスルーの向きについてはProMicroの取付時と同じく、合わせてください。  

左側![BMP-1](imgs/BMP-1.JPG)  
右側![BMP-2](imgs/BMP-2.JPG)  
**※この写真の例は12ピンコンスルーを使用する場合です。**  
**13ピンコンスルーならオフセットは不要です。**

左側BMP装着例![BMP-3](imgs/BMP-3.JPG)  
右側BMP装着例![BMP-4](imgs/BMP-4.JPG)  

LPME-IOのジャンパ部分![LPME-IO-1](imgs/LPME-IO-1.png)  
LPME-IOのジャンパ部分は少し盛り上がってしまいソケットとショートすることがあるので、テープを貼って絶縁しておくと確実です。
![LPME-IO-2](imgs/LPME-IO-2.png)  
LPME-IO装着例![LPME-IO-3](imgs/LPME-IO-3.png)  

### EX1-2. 電池部品のハンダ付け

電池部品はボトムプレートにハンダ付けします。  
ハンダ付けの前に、左右を取り違えない用にマスキングテープを貼って左右を識別できるようにしておくと良いです。  
**Check:LPME-IOを使用する場合はLPME-IO側（右側）の電池部品のハンダ付けは不要です。**  

![BMP-5](imgs/BMP-5.JPG)  
![BMP-6](imgs/BMP-6.JPG)  

まず、コンデンサとショットキーバリアダイオードをボトムプレートの表側（マスキングテープを貼っている方で、基板側となる方）に取り付けます。
この2つの部品は表面実装部品（基板表面に取り付ける部品）なので少しコツが必要です。  

まず基板に予備ハンダと呼ばれるハンダをちょっと盛っておきます。  

![BMP-7](imgs/BMP-7.JPG)  

その後、ピンセットでダイオードやコンデンサを持ち、予備ハンダをハンダごてで溶かしつつダイオードやコンデンサを基板に設置します。  

![BMP-8](imgs/BMP-8.JPG)  

予備ハンダを溶かして仮止めで来たら反対側のダイオードの足もハンダづけします。  
この際に長く温めすぎてハンダが尖ってしまったら、フラックスを追加してあげると上手くいきやすいです。  

![BMP-9](imgs/BMP-9.JPG)  

次にスライドスイッチをボトムプレートの裏側（マスキングテープを貼っていない方で、底側となる方）にハンダ付けします。  
スライドスイッチはツマミ部分を下側にして穴に差し込み、マスキングテープで仮止めします。

![BMP-10](imgs/BMP-10.JPG)  

ひっくり返してスライドスイッチの足を基板ギリギリで切り、ハンダ付けします。

![BMP-11](imgs/BMP-11.JPG)  
![BMP-12](imgs/BMP-12.JPG)  
![BMP-13](imgs/BMP-13.JPG)  

最後に電池ホルダーをボトムプレートの裏側（マスキングテープを貼っていない方で、底側となる方）にハンダ付けします。  
コイン電池ホルダーには上下の向きがありますので、以下の写真の向きを参考にしてください。  

![BMP-14](imgs/BMP-14.JPG)  

裏返してハンダ付けをする際に浮いてしまわないように、マスキングテープなどでホルダーを押さえておき、ハンダ付けします。

![BMP-16](imgs/BMP-16.JPG)  

単4電池ホルダーの場合も同様です。  
単4電池ホルダーの場合は左右に+極と-極がありますので、向きに注意してください。  

![BMP-15](imgs/BMP-15.JPG)  

こちらも裏返して足をギリギリで切ってハンダ付けします。  
浮いてしまったりする場合はマスキングテープで押さえておくとやりやすいです。  

![BMP-17](imgs/BMP-17.JPG)  

### EX1-3. 2ピンコンスルーの準備

電池を実装するボトムプレートとマイコンを実装する基板の間は2mmの2ピンコンスルーで接続します。  
コンスルーはニッパーやカッターで簡単に切れるので、12ピンのコンスルーから2ピン分切り出します。  
コンスルーの穴の直上で切るようにすると非常に簡単です。  

![BMP-18](imgs/BMP-18.JPG)  
![BMP-19](imgs/BMP-19.JPG)  

切り出した2ピンコンスルーを基板の接続用のピンに差します。  
BLE Micro Proの近くにあります。  
向きは気にしなくていいです。

![BMP-20](imgs/BMP-20.JPG)  

### EX1-4. ボトムプレートの接続

2ピンコンスルーを曲げないように慎重にボトムプレートを被せます。

![BMP-21](imgs/BMP-21.JPG)  

コイン電池ケースの場合は後の組み立て工程はProMicroのものと同様です。  
単4電池ケースを使用する場合は、スペーサー・オスメス（4mm）とスペーサー・オスメス（7mm）を組み合わせて使用します。  
まずボトムプレートに7mmのスペーサーをねじ込み、その上から4mmのスペーサーをねじ込みます。  
その上で、単4電池用の穴が空いたカバープレートを使用します。  
ゴム足も専用の大きめのものを使用します。

### EX1-5. ファームウェアの書き込み

ファームウェアは以下のBLE Micro Pro Web Configuratorから書き込みをしてください。  

https://sekigon-gonnoc.github.io/BLE-Micro-Pro-WebConfigurator/

BLE Micro Pro Web Configuratorの上から順番に実行してください。  
上から順番に実行した後、「キーボードごとの設定を書き込む」ボタンから「Ergo68」を選択して書き込んでください。  

![BMP-22](imgs/BMP-22.png)  
![BMP-23](imgs/BMP-23.png)  

設定を書き込み終わった後、Remap、もしくはBLE Micro Proのリポジトリからデフォルトキーマップを適用します。  

![BMP-22](imgs/BMP-24.png)  
![BMP-23](imgs/BMP-25.png)  

もしくはGitHubのBLE Micro ProのErgo68のデフォルトキーマップをダウンロードし、BLE Micro Proのリムーバブルメディアにドラッグ・アンド・ドロップします。  
https://github.com/sekigon-gonnoc/BLE-Micro-Pro/blob/master/AboutDefaultFirmware/keyboards/ergo68/KEYMAP.JSN

書き込み後は「3. リセットスイッチのハンダ付け」と同様の手順となります。  

**Point:Bluetooth接続が不安定、キーマップの書き換えが出来ない、などのBLE Micro Pro特有の問題については[こちら](https://github.com/sekigon-gonnoc/BLE-Micro-Pro/blob/master/docs/FAQ.md)のFAQを確認してください。**  
